{"version":3,"file":"static/js/241.a84a44ed.chunk.js","mappings":"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","sources":["api/orderApi.js","pages/admin/OrderManagementPage.jsx"],"sourcesContent":["import { fetchProduct, reduceStockApi } from \"./productApi\";\r\nimport client from \"./client\";\r\n\r\nexport const createOrderApi = async (payload) => {\r\n  const data = payload;\r\n  const orderItems = payload.orderItems;\r\n  try {\r\n    for (const item of orderItems) {\r\n      const product = await fetchProduct(item.productId);\r\n      await reduceStockApi(item.productId, product.stockQuantity - item.quantity);\r\n    }\r\n  } catch (error) {\r\n    console.error(error);\r\n  }\r\n  // Interceptor trong client sẽ tự động đính kèm token\r\n  const res = await client.post(\"/orders\", data);\r\n  return res;\r\n};\r\n\r\nexport const getMyOrdersApi = async (userId, params = {}) => {\r\n  // Interceptor trong client sẽ tự động đính kèm token\r\n  const res = await client.get(`/orders/user/${userId}`, { params });\r\n  return res.data;\r\n};\r\n\r\nexport const getAllOrdersApi = async () => {\r\n  // Interceptor trong client sẽ tự động đính kèm token\r\n  const res = await client.get(\"/orders\");\r\n  return res.data;\r\n};\r\n\r\nexport const updateOrderStatusApi = async (orderId, status) => {\r\n  try {\r\n    // Interceptor trong client sẽ tự động đính kèm token\r\n    const response = await client.patch(`/orders/${orderId}`, { status });\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error(`Error updating order status for order ${orderId}:`, error.response || error);\r\n    throw error.response?.data || new Error('Failed to update order status');\r\n  }\r\n};","import React, { useEffect, useState, useMemo, useCallback } from 'react';\r\nimport {\r\n  Alert,\r\n  Box,\r\n  Button,\r\n  Chip,\r\n  CircularProgress,\r\n  Dialog,\r\n  DialogActions,\r\n  DialogContent,\r\n  DialogTitle,\r\n  FormControl,\r\n  InputLabel,\r\n  List,\r\n  ListItem,\r\n  ListItemText,\r\n  MenuItem,\r\n  Paper,\r\n  Select,\r\n  Table,\r\n  TableBody,\r\n  TableCell,\r\n  TableContainer,\r\n  TableHead,\r\n  TableRow,\r\n  TableSortLabel,\r\n  TablePagination,\r\n  TextField,\r\n  Typography,\r\n} from '@mui/material';\r\nimport { getAllOrdersApi, updateOrderStatusApi } from '../../api/orderApi';\r\nimport { fetchProduct } from '../../api/productApi';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nexport default function OrderManagementPage() {\r\n  const ALL_STATUSES = [\"PENDING\", \"CONFIRMED\", \"PAID\", \"SHIPPED\", \"DELIVERED\", \"COMPLETED\", \"CANCELLED\", \"RETURNED\", \"REFUNDED\"];\r\n\r\n  const [orders, setOrders] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n  const [filters, setFilters] = useState({ search: '', status: '' });\r\n  const [sortConfig, setSortConfig] = useState({ key: 'createdAt', direction: 'desc' });\r\n  const [selectedOrder, setSelectedOrder] = useState(null);\r\n  const [isDetailOpen, setIsDetailOpen] = useState(false);\r\n  const [newStatus, setNewStatus] = useState('');\r\n  const [isUpdating, setIsUpdating] = useState(false);\r\n  const [notification, setNotification] = useState({ open: false, message: '', severity: 'success' });\r\n  const [page, setPage] = useState(0);\r\n  const [rowsPerPage, setRowsPerPage] = useState(10);\r\n  const { t } = useTranslation();\r\n\r\n  // Column configuration for sorting\r\n  const headCells = [\r\n    { id: 'id', numeric: false, disablePadding: false, label: t('profile.myOrders') + ' ID' },\r\n    { id: 'userName', numeric: false, disablePadding: false, label: t('profile.fullName') },\r\n    { id: 'createdAt', numeric: false, disablePadding: false, label: t('productPage.published') },\r\n    { id: 'totalAmount', numeric: true, disablePadding: false, label: t('cart.summary.total') },\r\n    { id: 'status', numeric: false, disablePadding: false, label: t('profile.settings'), sortable: false },\r\n  ];\r\n  \r\n  const fetchOrders = useCallback(async () => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n      const data = await getAllOrdersApi();\r\n      setOrders(data || []);\r\n    } catch (err) {\r\n      setError(t('admin.orderManagementPage.fetchError'));\r\n      setOrders([]); // Reset orders to an empty array on error\r\n      console.error(err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [t]);\r\n\r\n  useEffect(() => {\r\n    fetchOrders();\r\n  }, [fetchOrders]);\r\n\r\n  const handleFilterChange = (filterName, value) => {\r\n    setFilters(prevFilters => ({\r\n      ...prevFilters,\r\n      [filterName]: value,\r\n    }));\r\n  };\r\n\r\n  const handleSortRequest = (property) => {\r\n    const isAsc = sortConfig.key === property && sortConfig.direction === 'asc';\r\n    setSortConfig({ key: property, direction: isAsc ? 'desc' : 'asc' });\r\n  };\r\n\r\n  const handleRowClick = async (order) => {\r\n    // Hiển thị dialog với dữ liệu cơ bản trước\r\n    setSelectedOrder({ ...order, orderItems: [] }); // Hiển thị orderItems rỗng tạm thời\r\n    setNewStatus(order.status);\r\n    setIsDetailOpen(true);\r\n\r\n    try {\r\n      // Lấy thông tin chi tiết cho từng sản phẩm trong đơn hàng\r\n      const detailedItems = await Promise.all(\r\n        order.orderItems.map(async (item) => {\r\n          const productDetails = await fetchProduct(item.productId);\r\n          return { ...item, ...productDetails }; // Kết hợp thông tin số lượng và chi tiết sản phẩm\r\n        })\r\n      );\r\n      // Cập nhật lại state với đầy đủ thông tin sản phẩm\r\n      setSelectedOrder({ ...order, orderItems: detailedItems });\r\n    } catch (err) {\r\n      console.error(\"Failed to fetch product details for order:\", err);\r\n      setNotification({ open: true, message: t('admin.orderManagementPage.loadProductDetailsError'), severity: 'error' });\r\n    }\r\n  };\r\n\r\n  const handleCloseDetail = () => {\r\n    setIsDetailOpen(false);\r\n    setSelectedOrder(null);\r\n    setNewStatus('');\r\n  };\r\n\r\n  const handleStatusUpdate = async () => {\r\n    if (!selectedOrder || newStatus === selectedOrder.status) return;\r\n\r\n    setIsUpdating(true);\r\n    try {\r\n      const updatedOrder = await updateOrderStatusApi(selectedOrder.id, newStatus);\r\n      // Cập nhật lại danh sách đơn hàng trong state\r\n      setOrders(prevOrders => prevOrders.map(o => o.id === updatedOrder.id ? updatedOrder : o));\r\n      setNotification({ open: true, message: t('admin.orderManagementPage.updateSuccess'), severity: 'success' });\r\n      handleCloseDetail();\r\n    } catch (err) {\r\n      console.error(\"Failed to update status:\", err);\r\n      setNotification({ open: true, message: t('admin.orderManagementPage.updateError'), severity: 'error' });\r\n    } finally {\r\n      setIsUpdating(false);\r\n    }\r\n  };\r\n\r\n  const handleCloseNotification = (event, reason) => {\r\n    if (reason === 'clickaway') {\r\n      return;\r\n    }\r\n    setNotification({ ...notification, open: false });\r\n  };\r\n\r\n  const handleChangePage = (event, newPage) => {\r\n    setPage(newPage);\r\n  };\r\n\r\n  const handleChangeRowsPerPage = (event) => {\r\n    setRowsPerPage(parseInt(event.target.value, 10));\r\n    setPage(0);\r\n  };\r\n\r\n\r\n  const filteredAndSortedOrders = useMemo(() => {\r\n    let sortableItems = [...orders];\r\n\r\n    // Filtering\r\n    if (filters.search) {\r\n      const searchTerm = filters.search.toLowerCase();\r\n      sortableItems = sortableItems.filter(order =>\r\n        order.userName.toLowerCase().includes(searchTerm) ||\r\n        order.id.toString().includes(searchTerm)\r\n      );\r\n    }\r\n    if (filters.status) {\r\n      sortableItems = sortableItems.filter(order => order.status === filters.status);\r\n    }\r\n\r\n    // Sorting\r\n    if (sortConfig.key !== null) {\r\n      sortableItems.sort((a, b) => {\r\n        if (a[sortConfig.key] < b[sortConfig.key]) return sortConfig.direction === 'asc' ? -1 : 1;\r\n        if (a[sortConfig.key] > b[sortConfig.key]) return sortConfig.direction === 'asc' ? 1 : -1;\r\n        return 0;\r\n      });\r\n    }\r\n    return sortableItems;\r\n  }, [orders, filters, sortConfig]);\r\n\r\n  const getStatusChip = (status) => {\r\n    const statusMap = {\r\n      PENDING: { label: 'Pending', color: 'warning' },\r\n      CONFIRMED: { label: 'Confirmed', color: 'secondary' },\r\n      CANCELLED: { label: 'Cancelled', color: 'error' },\r\n      SHIPPED: { label: 'Shipped', color: 'primary' },\r\n      DELIVERED: { label: 'Delivered', color: 'success' },\r\n      COMPLETED: { label: 'Completed', color: 'success' },\r\n      PAID: { label: 'Paid', color: 'info' },\r\n      RETURNED: { label: 'Returned', color: 'default' },\r\n      REFUNDED: { label: 'Refunded', color: 'default' },\r\n    };\r\n    const { label, color } = statusMap[status] || { label: status, color: 'default' };\r\n    return <Chip label={label} color={color} size=\"small\" />;\r\n  };\r\n\r\n  return (\r\n    <Paper sx={{ p: 3, m: 2}}>\r\n      <Typography variant=\"h4\" gutterBottom>{t('admin.orderManagementPage.title')}</Typography>\r\n      \r\n      <Box sx={{ display: 'flex', gap: 2, mb: 3 }}>\r\n        <TextField\r\n          label={t('admin.orderManagementPage.searchPlaceholder')}\r\n          variant=\"outlined\"\r\n          size=\"small\"\r\n          value={filters.search}\r\n          onChange={(e) => handleFilterChange('search', e.target.value)}\r\n          sx={{ flexGrow: 1 }}\r\n        />\r\n        <FormControl size=\"small\" sx={{ minWidth: 180 }}>\r\n          <InputLabel>{t('profile.settings')}</InputLabel>\r\n          <Select\r\n            value={filters.status}\r\n            label={t('profile.settings')}\r\n            onChange={(e) => handleFilterChange('status', e.target.value)}\r\n            MenuProps={{ disableScrollLock: true }}\r\n          >\r\n            <MenuItem value=\"\"><em>{t('admin.orderManagementPage.allStatuses')}</em></MenuItem>\r\n            <MenuItem value=\"PENDING\">Pending</MenuItem>\r\n            <MenuItem value=\"CONFIRMED\">Confirmed</MenuItem>\r\n            <MenuItem value=\"PAID\">Paid</MenuItem>\r\n            <MenuItem value=\"SHIPPED\">Shipped</MenuItem>\r\n            <MenuItem value=\"DELIVERED\">Delivered</MenuItem>\r\n            <MenuItem value=\"COMPLETED\">Completed</MenuItem>\r\n            <MenuItem value=\"CANCELLED\">Cancelled</MenuItem>\r\n            <MenuItem value=\"RETURNED\">Returned</MenuItem>\r\n            <MenuItem value=\"REFUNDED\">Refunded</MenuItem>\r\n          </Select>\r\n        </FormControl>\r\n      </Box>\r\n\r\n      {loading ? (\r\n        <Box sx={{ display: 'flex', justifyContent: 'center', my: 5 }}><CircularProgress /></Box>\r\n      ) : error ? (\r\n        <Alert severity=\"error\">{error}</Alert>\r\n      ) : (\r\n        <>\r\n          <TableContainer>\r\n            <Table stickyHeader>\r\n              <TableHead>\r\n                <TableRow>\r\n                  {headCells.map((headCell) => (\r\n                    <TableCell\r\n                      key={headCell.id}\r\n                      align={headCell.numeric ? 'right' : headCell.id === 'status' ? 'center' : 'left'}\r\n                      sortDirection={sortConfig.key === headCell.id ? sortConfig.direction : false}\r\n                    >\r\n                      {headCell.sortable === false ? headCell.label : (\r\n                        <TableSortLabel\r\n                          active={sortConfig.key === headCell.id}\r\n                          direction={sortConfig.key === headCell.id ? sortConfig.direction : 'asc'}\r\n                          onClick={() => handleSortRequest(headCell.id)}\r\n                        >\r\n                          {headCell.label}\r\n                        </TableSortLabel>\r\n                      )}\r\n                    </TableCell>\r\n                  ))}\r\n                </TableRow>\r\n              </TableHead>\r\n              <TableBody>\r\n                {filteredAndSortedOrders\r\n                  .slice(page * rowsPerPage, page * rowsPerPage + rowsPerPage)\r\n                  .map((order) => (\r\n                    <TableRow hover key={order.id} onClick={() => handleRowClick(order)} sx={{ cursor: 'pointer' }}>\r\n                      <TableCell>#{order.id}</TableCell>\r\n                      <TableCell>{order.userName}</TableCell>\r\n                      <TableCell>{new Date(order.createdAt).toLocaleDateString()}</TableCell>\r\n                      <TableCell align=\"right\">${order.totalAmount.toFixed(2)}</TableCell>\r\n                      <TableCell align=\"center\" >{getStatusChip(order.status)}</TableCell>\r\n                    </TableRow>\r\n                  ))}\r\n              </TableBody>\r\n            </Table>\r\n          </TableContainer>\r\n          <TablePagination\r\n            rowsPerPageOptions={[5, 10, 25]}\r\n            component=\"div\"\r\n            count={filteredAndSortedOrders.length}\r\n            rowsPerPage={rowsPerPage}\r\n            page={page}\r\n            onPageChange={handleChangePage}\r\n            onRowsPerPageChange={handleChangeRowsPerPage}\r\n            SelectProps={{\r\n              MenuProps: {\r\n                disableScrollLock: true,\r\n                anchorOrigin: {\r\n                  vertical: 'top',\r\n                  horizontal: 'left',\r\n                },\r\n                transformOrigin: {\r\n                  vertical: 'bottom',\r\n                  horizontal: 'left',\r\n                },\r\n              },\r\n            }}\r\n          />\r\n        </>\r\n      )}\r\n\r\n      {/* Order Detail Modal */}\r\n      <Dialog open={isDetailOpen} onClose={handleCloseDetail} maxWidth=\"sm\" fullWidth disableScrollLock={true}>\r\n        <DialogTitle>{t('admin.orderManagementPage.orderDetails')}</DialogTitle>\r\n        {selectedOrder && (\r\n          <DialogContent dividers>\r\n            <Box sx={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 2 }}>\r\n              <Typography><strong>{t('profile.myOrders')} ID:</strong> #{selectedOrder.id}</Typography>\r\n              <Typography><strong>{t('profile.fullName')}:</strong> {selectedOrder.userName || `User ID: ${selectedOrder.userId}`}</Typography>\r\n              <Typography><strong>{t('productPage.published')}:</strong> {new Date(selectedOrder.createdAt).toLocaleString()}</Typography>\r\n              <Typography><strong>{t('cart.summary.total')}:</strong> ${selectedOrder.totalAmount.toFixed(2)}</Typography>\r\n            </Box>\r\n            \r\n            <FormControl fullWidth margin=\"normal\">\r\n              <InputLabel>{t('admin.orderManagementPage.updateStatus')}</InputLabel>\r\n              <Select\r\n                value={newStatus}\r\n                label={t('admin.orderManagementPage.updateStatus')}\r\n                onChange={(e) => setNewStatus(e.target.value)}\r\n                MenuProps={{ disableScrollLock: true }}\r\n              >\r\n                {ALL_STATUSES.map(status => (\r\n                  <MenuItem key={status} value={status}>{status}</MenuItem>\r\n                ))}\r\n              </Select>\r\n            </FormControl>\r\n\r\n            <Box mt={2}>\r\n              <Typography variant=\"h6\">{t('cart.title')}</Typography>\r\n              <List dense>\r\n                {selectedOrder.orderItems.map(item => (\r\n                  <ListItem key={item.productId} divider>\r\n                    <ListItemText\r\n                      primary={item.name + ' x ' + item.quantity || `Product ID: ${item.productId}`}\r\n                    />\r\n                    <Typography variant=\"body2\">\r\n                      ${(item.price * item.quantity).toFixed(2)}\r\n                    </Typography>\r\n                  </ListItem>\r\n                ))}\r\n              </List>\r\n            </Box>\r\n\r\n            {selectedOrder.shippingAddress && (\r\n              <Box mt={2}>\r\n                <Typography variant=\"h6\">{t('checkout.shippingInfo')}</Typography>\r\n                <Typography>{selectedOrder.shippingAddress}</Typography>\r\n              </Box>\r\n            )}\r\n          </DialogContent>\r\n        )}\r\n        <DialogActions>\r\n          <Button onClick={handleCloseDetail}>{t('action.cancel')}</Button>\r\n          <Button \r\n            onClick={handleStatusUpdate} \r\n            color=\"primary\" \r\n            variant=\"contained\"\r\n            disabled={isUpdating || newStatus === selectedOrder?.status}\r\n          >\r\n            {isUpdating ? <CircularProgress size={24} /> : t('action.saveChanges')}\r\n          </Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n\r\n      {notification.open && (\r\n        <Alert onClose={handleCloseNotification} severity={notification.severity} sx={{ width: '100%' }}>\r\n          {notification.message}\r\n        </Alert>\r\n      )}\r\n    </Paper>\r\n  );\r\n};\r\n"],"names":["createOrderApi","async","data","payload","orderItems","item","product","fetchProduct","productId","reduceStockApi","stockQuantity","quantity","error","console","client","post","getMyOrdersApi","userId","params","arguments","length","undefined","get","concat","getAllOrdersApi","updateOrderStatusApi","orderId","status","patch","_error$response","response","Error","OrderManagementPage","orders","setOrders","useState","loading","setLoading","setError","filters","setFilters","search","sortConfig","setSortConfig","key","direction","selectedOrder","setSelectedOrder","isDetailOpen","setIsDetailOpen","newStatus","setNewStatus","isUpdating","setIsUpdating","notification","setNotification","open","message","severity","page","setPage","rowsPerPage","setRowsPerPage","t","useTranslation","headCells","id","numeric","disablePadding","label","sortable","fetchOrders","useCallback","err","useEffect","handleFilterChange","filterName","value","prevFilters","_objectSpread","handleCloseDetail","filteredAndSortedOrders","useMemo","sortableItems","searchTerm","toLowerCase","filter","order","userName","includes","toString","sort","a","b","getStatusChip","color","PENDING","CONFIRMED","CANCELLED","SHIPPED","DELIVERED","COMPLETED","PAID","RETURNED","REFUNDED","_jsx","Chip","size","_jsxs","Paper","sx","p","m","children","Typography","variant","gutterBottom","Box","display","gap","mb","TextField","onChange","e","target","flexGrow","FormControl","minWidth","InputLabel","Select","MenuProps","disableScrollLock","MenuItem","justifyContent","my","CircularProgress","Alert","_Fragment","TableContainer","Table","stickyHeader","TableHead","TableRow","map","headCell","TableCell","align","sortDirection","TableSortLabel","active","onClick","property","isAsc","handleSortRequest","TableBody","slice","hover","detailedItems","Promise","all","productDetails","handleRowClick","cursor","Date","createdAt","toLocaleDateString","totalAmount","toFixed","TablePagination","rowsPerPageOptions","component","count","onPageChange","handleChangePage","event","newPage","onRowsPerPageChange","parseInt","SelectProps","anchorOrigin","vertical","horizontal","transformOrigin","Dialog","onClose","maxWidth","fullWidth","DialogTitle","DialogContent","dividers","gridTemplateColumns","toLocaleString","margin","mt","List","dense","ListItem","divider","ListItemText","primary","name","price","shippingAddress","DialogActions","Button","updatedOrder","prevOrders","o","disabled","handleCloseNotification","reason","width"],"ignoreList":[],"sourceRoot":""}