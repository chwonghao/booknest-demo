"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[864],{1819:(e,t,r)=>{r.d(t,{OL:()=>o,Qt:()=>i,ZS:()=>l,zr:()=>s});var a=r(2554),n=r(4512);const s=async e=>{const t=e,r=e.orderItems;try{for(const e of r){const t=await(0,a.yj)(e.productId);await(0,a.NM)(e.productId,t.stockQuantity-e.quantity)}}catch(s){console.error(s)}return await n.A.post("/orders",t)},i=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(await n.A.get("/orders/user/".concat(e),{params:t})).data},l=async()=>(await n.A.get("/orders")).data,o=async(e,t)=>{try{return(await n.A.patch("/orders/".concat(e),{status:t})).data}catch(a){var r;throw console.error("Error updating order status for order ".concat(e,":"),a.response||a),(null===(r=a.response)||void 0===r?void 0:r.data)||new Error("Failed to update order status")}}},1864:(e,t,r)=>{r.r(t),r.d(t,{default:()=>S});var a=r(9379),n=r(5043),s=r(6446),i=r(1637),l=r(9252),o=r(5865),c=r(1906),d=r(8903),u=r(3336),h=r(5795),m=r(3193),x=r(1292),p=r(7972),A=r(4605),j=r(4791),y=r(9336),g=r(5721),b=r(681),f=r(8734),v=r(4117),k=r(8163),N=r(2603),w=r(5187),C=r(7488),W=r(2452),I=r(1819),q=r(579);const S=()=>{const{t:e,i18n:t}=(0,v.Bd)(),r=(0,k.Zp)(),{items:S,total:R,clearCart:z}=(0,n.useContext)(N.M),{user:B,isAuthenticated:E,loading:F}=(0,n.useContext)(w.c),[M,P]=(0,n.useState)({fullName:(null===B||void 0===B?void 0:B.fullName)||"",address:(null===B||void 0===B?void 0:B.address)||"",phoneNumber:(null===B||void 0===B?void 0:B.phoneNumber)||"",email:(null===B||void 0===B?void 0:B.email)||""}),[D,G]=(0,n.useState)("cod"),[L,O]=(0,n.useState)(!1),Q=e=>{if(null===e||void 0===e)return"";if("vi"===t.language.split("-")[0]){return"".concat((25e3*e).toLocaleString("vi-VN")," \u20ab")}return"$".concat(e.toFixed(2))};(0,n.useEffect)(()=>{F||E||(C.oR.info(e("cart.summary.loginPrompt")),r("/login",{state:{from:"/checkout"},replace:!0}))},[E,F,r,e]);const Z=e=>{P((0,a.A)((0,a.A)({},M),{},{[e.target.name]:e.target.value}))};return F||!E?(0,q.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"60vh"},children:(0,q.jsx)(i.A,{})}):0===S.length?(0,q.jsxs)(l.A,{sx:{textAlign:"center",mt:8},children:[(0,q.jsx)(o.A,{variant:"h5",children:e("checkout.noItems")}),(0,q.jsx)(c.A,{variant:"contained",sx:{mt:2},onClick:()=>r("/"),children:e("cart.continueShopping")})]}):(0,q.jsxs)(l.A,{maxWidth:"lg",sx:{mt:4,mb:4},children:[(0,q.jsx)(W.A,{links:[{label:e("breadcrumbs.checkout")}],sx:{mb:3}}),(0,q.jsx)(o.A,{variant:"h4",component:"h1",gutterBottom:!0,fontWeight:"bold",children:e("checkout.title")}),(0,q.jsx)("form",{onSubmit:async t=>{t.preventDefault(),O(!0);try{const t={userId:B.id,userName:B.fullName,orderItems:S.map(e=>({productId:e.id,quantity:e.qty})),totalAmount:R,status:"PENDING"};await(0,I.zr)(t),C.oR.success(e("checkout.orderPlacedSuccess")),z(),r("/cart")}catch(s){var a,n;console.error("Failed to place order:",s),C.oR.error((null===(a=s.response)||void 0===a||null===(n=a.data)||void 0===n?void 0:n.message)||"Failed to place order. Please try again.")}finally{O(!1)}},children:(0,q.jsxs)(d.Ay,{container:!0,spacing:4,children:[(0,q.jsxs)(d.Ay,{item:!0,xs:12,md:7,children:[(0,q.jsxs)(u.A,{variant:"outlined",sx:{p:3,borderRadius:2},children:[(0,q.jsx)(o.A,{variant:"h6",gutterBottom:!0,children:e("checkout.shippingInfo")}),(0,q.jsxs)(d.Ay,{container:!0,spacing:2,children:[(0,q.jsx)(d.Ay,{item:!0,xs:12,children:(0,q.jsx)(h.A,{required:!0,fullWidth:!0,name:"fullName",label:e("register.fullName"),value:M.fullName,onChange:Z})}),(0,q.jsx)(d.Ay,{item:!0,xs:12,children:(0,q.jsx)(h.A,{required:!0,fullWidth:!0,name:"address",label:e("register.address"),value:M.address,onChange:Z})}),(0,q.jsx)(d.Ay,{item:!0,xs:12,sm:6,children:(0,q.jsx)(h.A,{required:!0,fullWidth:!0,name:"phoneNumber",label:e("register.phoneNumber"),value:M.phoneNumber,onChange:Z})}),(0,q.jsx)(d.Ay,{item:!0,xs:12,sm:6,children:(0,q.jsx)(h.A,{required:!0,fullWidth:!0,name:"email",type:"email",label:e("register.email"),value:M.email,onChange:Z})})]})]}),(0,q.jsx)(u.A,{variant:"outlined",sx:{p:3,mt:4,borderRadius:2},children:(0,q.jsxs)(m.A,{component:"fieldset",children:[(0,q.jsx)(x.A,{component:"legend",sx:{mb:1,fontWeight:"bold",color:"text.primary"},children:e("checkout.paymentMethod")}),(0,q.jsxs)(p.A,{row:!0,name:"paymentMethod",value:D,onChange:e=>G(e.target.value),children:[(0,q.jsx)(A.A,{value:"cod",control:(0,q.jsx)(j.A,{}),label:e("checkout.cod")}),(0,q.jsx)(A.A,{value:"paypal",control:(0,q.jsx)(j.A,{}),label:e("checkout.paypal"),disabled:!0})]})]})})]}),(0,q.jsx)(d.Ay,{item:!0,xs:12,md:5,children:(0,q.jsxs)(u.A,{variant:"outlined",sx:{p:3,position:"sticky",top:88,borderRadius:2},children:[(0,q.jsx)(o.A,{variant:"h6",gutterBottom:!0,children:e("cart.summary.title")}),(0,q.jsx)(y.A,{}),(0,q.jsx)(g.A,{children:S.map(e=>(0,q.jsxs)(b.Ay,{disableGutters:!0,children:[(0,q.jsx)(f.A,{primary:"".concat(e.name," (x").concat(e.qty,")"),secondary:e.author}),(0,q.jsx)(o.A,{variant:"body2",children:Q(e.price*e.qty)})]},e.id))}),(0,q.jsx)(y.A,{}),(0,q.jsxs)(s.A,{sx:{display:"flex",justifyContent:"space-between",my:2},children:[(0,q.jsx)(o.A,{children:e("cart.summary.subtotal",{count:S.length})}),(0,q.jsx)(o.A,{fontWeight:"bold",children:Q(R)})]}),(0,q.jsxs)(s.A,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[(0,q.jsx)(o.A,{children:e("cart.summary.shipping")}),(0,q.jsx)(o.A,{fontWeight:"bold",children:e("cart.summary.free")})]}),(0,q.jsx)(y.A,{}),(0,q.jsxs)(s.A,{sx:{display:"flex",justifyContent:"space-between",mt:2,mb:3},children:[(0,q.jsx)(o.A,{variant:"h5",fontWeight:"bold",children:e("cart.summary.total")}),(0,q.jsx)(o.A,{variant:"h5",fontWeight:"bold",children:Q(R)})]}),(0,q.jsx)(c.A,{type:"submit",fullWidth:!0,variant:"contained",size:"large",disabled:L,children:L?(0,q.jsx)(i.A,{size:26,color:"inherit"}):e("checkout.placeOrder")})]})})]})})]})}},2452:(e,t,r)=>{r.d(t,{A:()=>u});r(5043);var a=r(9252),n=r(2698),s=r(5865),i=r(8446),l=r(8163),o=r(4117),c=r(3639),d=r(579);const u=e=>{let{links:t=[]}=e;const{t:r}=(0,o.Bd)(),u=[{to:"/",label:r("breadcrumbs.home"),icon:(0,d.jsx)(c.A,{sx:{mr:2,fontSize:"inherit"}})},...t];return(0,d.jsx)(a.A,{maxWidth:"lg",sx:{pt:0,pb:{xs:1,md:2}},children:(0,d.jsx)(n.A,{"aria-label":"breadcrumb",children:u.map((e,t)=>t===u.length-1?(0,d.jsxs)(s.A,{color:"text.primary",sx:{display:"flex",alignItems:"center"},children:[e.icon,e.label]},t):(0,d.jsxs)(i.A,{component:l.N_,to:e.to,underline:"hover",color:"inherit",sx:{display:"flex",alignItems:"center"},children:[e.icon,e.label]},t))})})}}}]);
//# sourceMappingURL=864.970b79f2.chunk.js.map