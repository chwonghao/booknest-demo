"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[241],{1819:(e,r,a)=>{a.d(r,{OL:()=>d,Qt:()=>l,ZS:()=>i,zr:()=>n});var s=a(2554),t=a(4512);const n=async e=>{const r=e,a=e.orderItems;try{for(const e of a){const r=await(0,s.yj)(e.productId);await(0,s.NM)(e.productId,r.stockQuantity-e.quantity)}}catch(n){console.error(n)}return await t.A.post("/orders",r)},l=async function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(await t.A.get("/orders/user/".concat(e),{params:r})).data},i=async()=>(await t.A.get("/orders")).data,d=async(e,r)=>{try{return(await t.A.patch("/orders/".concat(e),{status:r})).data}catch(s){var a;throw console.error("Error updating order status for order ".concat(e,":"),s.response||s),(null===(a=s.response)||void 0===a?void 0:a.data)||new Error("Failed to update order status")}}},5241:(e,r,a)=>{a.r(r),a.d(r,{default:()=>O});var s=a(9379),t=a(5043),n=a(3845),l=a(3336),i=a(5865),d=a(6446),o=a(5795),c=a(3193),u=a(8356),h=a(9285),A=a(2143),m=a(1637),x=a(4194),g=a(9650),p=a(1806),j=a(4882),y=a(8076),f=a(2420),P=a(8093),v=a(3460),E=a(1574),D=a(35),b=a(6600),C=a(2935),I=a(5721),S=a(681),k=a(8734),w=a(9347),N=a(1906),L=a(1819),M=a(2554),R=a(4117),F=a(579);function O(){const[e,r]=(0,t.useState)([]),[a,O]=(0,t.useState)(!0),[z,T]=(0,t.useState)(null),[U,G]=(0,t.useState)({search:"",status:""}),[H,W]=(0,t.useState)({key:"createdAt",direction:"desc"}),[q,V]=(0,t.useState)(null),[$,B]=(0,t.useState)(!1),[Q,Z]=(0,t.useState)(""),[J,K]=(0,t.useState)(!1),[X,Y]=(0,t.useState)({open:!1,message:"",severity:"success"}),[_,ee]=(0,t.useState)(0),[re,ae]=(0,t.useState)(10),{t:se}=(0,R.Bd)(),te=[{id:"id",numeric:!1,disablePadding:!1,label:se("profile.myOrders")+" ID"},{id:"userName",numeric:!1,disablePadding:!1,label:se("profile.fullName")},{id:"createdAt",numeric:!1,disablePadding:!1,label:se("productPage.published")},{id:"totalAmount",numeric:!0,disablePadding:!1,label:se("cart.summary.total")},{id:"status",numeric:!1,disablePadding:!1,label:se("profile.settings"),sortable:!1}],ne=(0,t.useCallback)(async()=>{try{O(!0),T(null);const e=await(0,L.ZS)();r(e||[])}catch(e){T(se("admin.orderManagementPage.fetchError")),r([]),console.error(e)}finally{O(!1)}},[se]);(0,t.useEffect)(()=>{ne()},[ne]);const le=(e,r)=>{G(a=>(0,s.A)((0,s.A)({},a),{},{[e]:r}))},ie=()=>{B(!1),V(null),Z("")},de=(0,t.useMemo)(()=>{let r=[...e];if(U.search){const e=U.search.toLowerCase();r=r.filter(r=>r.userName.toLowerCase().includes(e)||r.id.toString().includes(e))}return U.status&&(r=r.filter(e=>e.status===U.status)),null!==H.key&&r.sort((e,r)=>e[H.key]<r[H.key]?"asc"===H.direction?-1:1:e[H.key]>r[H.key]?"asc"===H.direction?1:-1:0),r},[e,U,H]),oe=e=>{const{label:r,color:a}={PENDING:{label:"Pending",color:"warning"},CONFIRMED:{label:"Confirmed",color:"secondary"},CANCELLED:{label:"Cancelled",color:"error"},SHIPPED:{label:"Shipped",color:"primary"},DELIVERED:{label:"Delivered",color:"success"},COMPLETED:{label:"Completed",color:"success"},PAID:{label:"Paid",color:"info"},RETURNED:{label:"Returned",color:"default"},REFUNDED:{label:"Refunded",color:"default"}}[e]||{label:e,color:"default"};return(0,F.jsx)(n.A,{label:r,color:a,size:"small"})};return(0,F.jsxs)(l.A,{sx:{p:3,m:2},children:[(0,F.jsx)(i.A,{variant:"h4",gutterBottom:!0,children:se("admin.orderManagementPage.title")}),(0,F.jsxs)(d.A,{sx:{display:"flex",gap:2,mb:3},children:[(0,F.jsx)(o.A,{label:se("admin.orderManagementPage.searchPlaceholder"),variant:"outlined",size:"small",value:U.search,onChange:e=>le("search",e.target.value),sx:{flexGrow:1}}),(0,F.jsxs)(c.A,{size:"small",sx:{minWidth:180},children:[(0,F.jsx)(u.A,{children:se("profile.settings")}),(0,F.jsxs)(h.A,{value:U.status,label:se("profile.settings"),onChange:e=>le("status",e.target.value),MenuProps:{disableScrollLock:!0},children:[(0,F.jsx)(A.A,{value:"",children:(0,F.jsx)("em",{children:se("admin.orderManagementPage.allStatuses")})}),(0,F.jsx)(A.A,{value:"PENDING",children:"Pending"}),(0,F.jsx)(A.A,{value:"CONFIRMED",children:"Confirmed"}),(0,F.jsx)(A.A,{value:"PAID",children:"Paid"}),(0,F.jsx)(A.A,{value:"SHIPPED",children:"Shipped"}),(0,F.jsx)(A.A,{value:"DELIVERED",children:"Delivered"}),(0,F.jsx)(A.A,{value:"COMPLETED",children:"Completed"}),(0,F.jsx)(A.A,{value:"CANCELLED",children:"Cancelled"}),(0,F.jsx)(A.A,{value:"RETURNED",children:"Returned"}),(0,F.jsx)(A.A,{value:"REFUNDED",children:"Refunded"})]})]})]}),a?(0,F.jsx)(d.A,{sx:{display:"flex",justifyContent:"center",my:5},children:(0,F.jsx)(m.A,{})}):z?(0,F.jsx)(x.A,{severity:"error",children:z}):(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(g.A,{children:(0,F.jsxs)(p.A,{stickyHeader:!0,children:[(0,F.jsx)(j.A,{children:(0,F.jsx)(y.A,{children:te.map(e=>(0,F.jsx)(f.A,{align:e.numeric?"right":"status"===e.id?"center":"left",sortDirection:H.key===e.id&&H.direction,children:!1===e.sortable?e.label:(0,F.jsx)(P.A,{active:H.key===e.id,direction:H.key===e.id?H.direction:"asc",onClick:()=>(e=>{const r=H.key===e&&"asc"===H.direction;W({key:e,direction:r?"desc":"asc"})})(e.id),children:e.label})},e.id))})}),(0,F.jsx)(v.A,{children:de.slice(_*re,_*re+re).map(e=>(0,F.jsxs)(y.A,{hover:!0,onClick:()=>(async e=>{V((0,s.A)((0,s.A)({},e),{},{orderItems:[]})),Z(e.status),B(!0);try{const r=await Promise.all(e.orderItems.map(async e=>{const r=await(0,M.yj)(e.productId);return(0,s.A)((0,s.A)({},e),r)}));V((0,s.A)((0,s.A)({},e),{},{orderItems:r}))}catch(r){console.error("Failed to fetch product details for order:",r),Y({open:!0,message:se("admin.orderManagementPage.loadProductDetailsError"),severity:"error"})}})(e),sx:{cursor:"pointer"},children:[(0,F.jsxs)(f.A,{children:["#",e.id]}),(0,F.jsx)(f.A,{children:e.userName}),(0,F.jsx)(f.A,{children:new Date(e.createdAt).toLocaleDateString()}),(0,F.jsxs)(f.A,{align:"right",children:["$",e.totalAmount.toFixed(2)]}),(0,F.jsx)(f.A,{align:"center",children:oe(e.status)})]},e.id))})]})}),(0,F.jsx)(E.A,{rowsPerPageOptions:[5,10,25],component:"div",count:de.length,rowsPerPage:re,page:_,onPageChange:(e,r)=>{ee(r)},onRowsPerPageChange:e=>{ae(parseInt(e.target.value,10)),ee(0)},SelectProps:{MenuProps:{disableScrollLock:!0,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"left"}}}})]}),(0,F.jsxs)(D.A,{open:$,onClose:ie,maxWidth:"sm",fullWidth:!0,disableScrollLock:!0,children:[(0,F.jsx)(b.A,{children:se("admin.orderManagementPage.orderDetails")}),q&&(0,F.jsxs)(C.A,{dividers:!0,children:[(0,F.jsxs)(d.A,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2},children:[(0,F.jsxs)(i.A,{children:[(0,F.jsxs)("strong",{children:[se("profile.myOrders")," ID:"]})," #",q.id]}),(0,F.jsxs)(i.A,{children:[(0,F.jsxs)("strong",{children:[se("profile.fullName"),":"]})," ",q.userName||"User ID: ".concat(q.userId)]}),(0,F.jsxs)(i.A,{children:[(0,F.jsxs)("strong",{children:[se("productPage.published"),":"]})," ",new Date(q.createdAt).toLocaleString()]}),(0,F.jsxs)(i.A,{children:[(0,F.jsxs)("strong",{children:[se("cart.summary.total"),":"]})," $",q.totalAmount.toFixed(2)]})]}),(0,F.jsxs)(c.A,{fullWidth:!0,margin:"normal",children:[(0,F.jsx)(u.A,{children:se("admin.orderManagementPage.updateStatus")}),(0,F.jsx)(h.A,{value:Q,label:se("admin.orderManagementPage.updateStatus"),onChange:e=>Z(e.target.value),MenuProps:{disableScrollLock:!0},children:["PENDING","CONFIRMED","PAID","SHIPPED","DELIVERED","COMPLETED","CANCELLED","RETURNED","REFUNDED"].map(e=>(0,F.jsx)(A.A,{value:e,children:e},e))})]}),(0,F.jsxs)(d.A,{mt:2,children:[(0,F.jsx)(i.A,{variant:"h6",children:se("cart.title")}),(0,F.jsx)(I.A,{dense:!0,children:q.orderItems.map(e=>(0,F.jsxs)(S.Ay,{divider:!0,children:[(0,F.jsx)(k.A,{primary:e.name+" x "+e.quantity||"Product ID: ".concat(e.productId)}),(0,F.jsxs)(i.A,{variant:"body2",children:["$",(e.price*e.quantity).toFixed(2)]})]},e.productId))})]}),q.shippingAddress&&(0,F.jsxs)(d.A,{mt:2,children:[(0,F.jsx)(i.A,{variant:"h6",children:se("checkout.shippingInfo")}),(0,F.jsx)(i.A,{children:q.shippingAddress})]})]}),(0,F.jsxs)(w.A,{children:[(0,F.jsx)(N.A,{onClick:ie,children:se("action.cancel")}),(0,F.jsx)(N.A,{onClick:async()=>{if(q&&Q!==q.status){K(!0);try{const e=await(0,L.OL)(q.id,Q);r(r=>r.map(r=>r.id===e.id?e:r)),Y({open:!0,message:se("admin.orderManagementPage.updateSuccess"),severity:"success"}),ie()}catch(e){console.error("Failed to update status:",e),Y({open:!0,message:se("admin.orderManagementPage.updateError"),severity:"error"})}finally{K(!1)}}},color:"primary",variant:"contained",disabled:J||Q===(null===q||void 0===q?void 0:q.status),children:J?(0,F.jsx)(m.A,{size:24}):se("action.saveChanges")})]})]}),X.open&&(0,F.jsx)(x.A,{onClose:(e,r)=>{"clickaway"!==r&&Y((0,s.A)((0,s.A)({},X),{},{open:!1}))},severity:X.severity,sx:{width:"100%"},children:X.message})]})}}}]);
//# sourceMappingURL=241.a84a44ed.chunk.js.map