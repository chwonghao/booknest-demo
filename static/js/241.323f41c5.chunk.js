"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[241],{1819:(e,r,t)=>{t.d(r,{OL:()=>c,Qt:()=>o,ZS:()=>d,zr:()=>l});var s=t(2554);let a=[{id:101,userId:1,orderDate:new Date("2023-10-26T10:00:00Z").toISOString(),status:"DELIVERED",totalAmount:229e3,shippingAddress:{fullName:"Ng\u01b0\u1eddi D\xf9ng Demo",address:"123 \u0110\u01b0\u1eddng ABC, Qu\u1eadn 1, TP. HCM",phoneNumber:"0123456789"},orderItems:[{productId:1,name:"L\u01b0\u1ee3c S\u1eed Lo\xe0i Ng\u01b0\u1eddi",quantity:1,price:15e4},{productId:2,name:"Nh\xe0 Gi\u1ea3 Kim",quantity:1,price:79e3}]},{id:102,userId:1,orderDate:new Date("2023-10-28T14:30:00Z").toISOString(),status:"PENDING",totalAmount:165e3,shippingAddress:{fullName:"Ng\u01b0\u1eddi D\xf9ng Demo",address:"123 \u0110\u01b0\u1eddng ABC, Qu\u1eadn 1, TP. HCM",phoneNumber:"0123456789"},orderItems:[{productId:4,name:"Sapiens: L\u01b0\u1ee3c S\u1eed T\u01b0\u01a1ng Lai",quantity:1,price:165e3}]}],n=103;const i=e=>new Promise(r=>setTimeout(r,e)),l=async e=>{await i(1e3),console.log("MOCK: createOrderApi",e);try{for(const r of e.orderItems){const e=await(0,s.yj)(r.productId);await(0,s.NM)(r.productId,e.stockQuantity-r.quantity)}}catch(t){throw console.error("MOCK: L\u1ed7i tr\u1eeb kho khi t\u1ea1o \u0111\u01a1n h\xe0ng",t),new Error("Kh\xf4ng th\u1ec3 c\u1eadp nh\u1eadt kho, \u0111\u01a1n h\xe0ng ch\u01b0a \u0111\u01b0\u1ee3c t\u1ea1o.")}const r={id:n++,userId:e.userId,orderDate:(new Date).toISOString(),status:"PENDING",totalAmount:e.totalAmount,orderItems:e.orderItems,shippingAddress:e.shippingAddress};return a.push(r),{data:r}},o=async function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await i(500),console.log("MOCK: getMyOrdersApi for user ".concat(e),{params:r}),a.filter(r=>r.userId.toString()===e.toString())},d=async()=>(await i(500),console.log("MOCK: getAllOrdersApi"),[...a]),c=async(e,r)=>{await i(300),console.log("MOCK: updateOrderStatusApi for order ".concat(e," to status ").concat(r));const t=a.find(r=>r.id.toString()===e.toString());if(t)return t.status=r,t;throw new Error("Order not found")}},5241:(e,r,t)=>{t.r(r),t.d(r,{default:()=>T});var s=t(9379),a=t(5043),n=t(3845),i=t(3336),l=t(5865),o=t(6446),d=t(5795),c=t(3193),u=t(8356),h=t(9285),m=t(2143),g=t(1637),A=t(4194),p=t(9650),x=t(1806),j=t(4882),y=t(8076),D=t(2420),f=t(8093),P=t(3460),E=t(1574),I=t(35),v=t(6600),C=t(2935),S=t(5721),b=t(681),N=t(8734),k=t(9347),w=t(1906),M=t(1819),L=t(2554),O=t(4117),R=t(579);function T(){const[e,r]=(0,a.useState)([]),[t,T]=(0,a.useState)(!0),[F,z]=(0,a.useState)(null),[G,K]=(0,a.useState)({search:"",status:""}),[U,q]=(0,a.useState)({key:"createdAt",direction:"desc"}),[H,B]=(0,a.useState)(null),[Q,V]=(0,a.useState)(!1),[W,Z]=(0,a.useState)(""),[$,J]=(0,a.useState)(!1),[X,Y]=(0,a.useState)({open:!1,message:"",severity:"success"}),[_,ee]=(0,a.useState)(0),[re,te]=(0,a.useState)(10),{t:se}=(0,O.Bd)(),ae=[{id:"id",numeric:!1,disablePadding:!1,label:se("profile.myOrders")+" ID"},{id:"userName",numeric:!1,disablePadding:!1,label:se("profile.fullName")},{id:"createdAt",numeric:!1,disablePadding:!1,label:se("productPage.published")},{id:"totalAmount",numeric:!0,disablePadding:!1,label:se("cart.summary.total")},{id:"status",numeric:!1,disablePadding:!1,label:se("profile.settings"),sortable:!1}],ne=(0,a.useCallback)(async()=>{try{T(!0),z(null);const e=await(0,M.ZS)();r(e||[])}catch(e){z(se("admin.orderManagementPage.fetchError")),r([]),console.error(e)}finally{T(!1)}},[se]);(0,a.useEffect)(()=>{ne()},[ne]);const ie=(e,r)=>{K(t=>(0,s.A)((0,s.A)({},t),{},{[e]:r}))},le=()=>{V(!1),B(null),Z("")},oe=(0,a.useMemo)(()=>{let r=[...e];if(G.search){const e=G.search.toLowerCase();r=r.filter(r=>r.userName.toLowerCase().includes(e)||r.id.toString().includes(e))}return G.status&&(r=r.filter(e=>e.status===G.status)),null!==U.key&&r.sort((e,r)=>e[U.key]<r[U.key]?"asc"===U.direction?-1:1:e[U.key]>r[U.key]?"asc"===U.direction?1:-1:0),r},[e,G,U]),de=e=>{const{label:r,color:t}={PENDING:{label:"Pending",color:"warning"},CONFIRMED:{label:"Confirmed",color:"secondary"},CANCELLED:{label:"Cancelled",color:"error"},SHIPPED:{label:"Shipped",color:"primary"},DELIVERED:{label:"Delivered",color:"success"},COMPLETED:{label:"Completed",color:"success"},PAID:{label:"Paid",color:"info"},RETURNED:{label:"Returned",color:"default"},REFUNDED:{label:"Refunded",color:"default"}}[e]||{label:e,color:"default"};return(0,R.jsx)(n.A,{label:r,color:t,size:"small"})};return(0,R.jsxs)(i.A,{sx:{p:3,m:2},children:[(0,R.jsx)(l.A,{variant:"h4",gutterBottom:!0,children:se("admin.orderManagementPage.title")}),(0,R.jsxs)(o.A,{sx:{display:"flex",gap:2,mb:3},children:[(0,R.jsx)(d.A,{label:se("admin.orderManagementPage.searchPlaceholder"),variant:"outlined",size:"small",value:G.search,onChange:e=>ie("search",e.target.value),sx:{flexGrow:1}}),(0,R.jsxs)(c.A,{size:"small",sx:{minWidth:180},children:[(0,R.jsx)(u.A,{children:se("profile.settings")}),(0,R.jsxs)(h.A,{value:G.status,label:se("profile.settings"),onChange:e=>ie("status",e.target.value),MenuProps:{disableScrollLock:!0},children:[(0,R.jsx)(m.A,{value:"",children:(0,R.jsx)("em",{children:se("admin.orderManagementPage.allStatuses")})}),(0,R.jsx)(m.A,{value:"PENDING",children:"Pending"}),(0,R.jsx)(m.A,{value:"CONFIRMED",children:"Confirmed"}),(0,R.jsx)(m.A,{value:"PAID",children:"Paid"}),(0,R.jsx)(m.A,{value:"SHIPPED",children:"Shipped"}),(0,R.jsx)(m.A,{value:"DELIVERED",children:"Delivered"}),(0,R.jsx)(m.A,{value:"COMPLETED",children:"Completed"}),(0,R.jsx)(m.A,{value:"CANCELLED",children:"Cancelled"}),(0,R.jsx)(m.A,{value:"RETURNED",children:"Returned"}),(0,R.jsx)(m.A,{value:"REFUNDED",children:"Refunded"})]})]})]}),t?(0,R.jsx)(o.A,{sx:{display:"flex",justifyContent:"center",my:5},children:(0,R.jsx)(g.A,{})}):F?(0,R.jsx)(A.A,{severity:"error",children:F}):(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(p.A,{children:(0,R.jsxs)(x.A,{stickyHeader:!0,children:[(0,R.jsx)(j.A,{children:(0,R.jsx)(y.A,{children:ae.map(e=>(0,R.jsx)(D.A,{align:e.numeric?"right":"status"===e.id?"center":"left",sortDirection:U.key===e.id&&U.direction,children:!1===e.sortable?e.label:(0,R.jsx)(f.A,{active:U.key===e.id,direction:U.key===e.id?U.direction:"asc",onClick:()=>(e=>{const r=U.key===e&&"asc"===U.direction;q({key:e,direction:r?"desc":"asc"})})(e.id),children:e.label})},e.id))})}),(0,R.jsx)(P.A,{children:oe.slice(_*re,_*re+re).map(e=>(0,R.jsxs)(y.A,{hover:!0,onClick:()=>(async e=>{B((0,s.A)((0,s.A)({},e),{},{orderItems:[]})),Z(e.status),V(!0);try{const r=await Promise.all(e.orderItems.map(async e=>{const r=await(0,L.yj)(e.productId);return(0,s.A)((0,s.A)({},e),r)}));B((0,s.A)((0,s.A)({},e),{},{orderItems:r}))}catch(r){console.error("Failed to fetch product details for order:",r),Y({open:!0,message:se("admin.orderManagementPage.loadProductDetailsError"),severity:"error"})}})(e),sx:{cursor:"pointer"},children:[(0,R.jsxs)(D.A,{children:["#",e.id]}),(0,R.jsx)(D.A,{children:e.userName}),(0,R.jsx)(D.A,{children:new Date(e.createdAt).toLocaleDateString()}),(0,R.jsxs)(D.A,{align:"right",children:["$",e.totalAmount.toFixed(2)]}),(0,R.jsx)(D.A,{align:"center",children:de(e.status)})]},e.id))})]})}),(0,R.jsx)(E.A,{rowsPerPageOptions:[5,10,25],component:"div",count:oe.length,rowsPerPage:re,page:_,onPageChange:(e,r)=>{ee(r)},onRowsPerPageChange:e=>{te(parseInt(e.target.value,10)),ee(0)},SelectProps:{MenuProps:{disableScrollLock:!0,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"left"}}}})]}),(0,R.jsxs)(I.A,{open:Q,onClose:le,maxWidth:"sm",fullWidth:!0,disableScrollLock:!0,children:[(0,R.jsx)(v.A,{children:se("admin.orderManagementPage.orderDetails")}),H&&(0,R.jsxs)(C.A,{dividers:!0,children:[(0,R.jsxs)(o.A,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2},children:[(0,R.jsxs)(l.A,{children:[(0,R.jsxs)("strong",{children:[se("profile.myOrders")," ID:"]})," #",H.id]}),(0,R.jsxs)(l.A,{children:[(0,R.jsxs)("strong",{children:[se("profile.fullName"),":"]})," ",H.userName||"User ID: ".concat(H.userId)]}),(0,R.jsxs)(l.A,{children:[(0,R.jsxs)("strong",{children:[se("productPage.published"),":"]})," ",new Date(H.createdAt).toLocaleString()]}),(0,R.jsxs)(l.A,{children:[(0,R.jsxs)("strong",{children:[se("cart.summary.total"),":"]})," $",H.totalAmount.toFixed(2)]})]}),(0,R.jsxs)(c.A,{fullWidth:!0,margin:"normal",children:[(0,R.jsx)(u.A,{children:se("admin.orderManagementPage.updateStatus")}),(0,R.jsx)(h.A,{value:W,label:se("admin.orderManagementPage.updateStatus"),onChange:e=>Z(e.target.value),MenuProps:{disableScrollLock:!0},children:["PENDING","CONFIRMED","PAID","SHIPPED","DELIVERED","COMPLETED","CANCELLED","RETURNED","REFUNDED"].map(e=>(0,R.jsx)(m.A,{value:e,children:e},e))})]}),(0,R.jsxs)(o.A,{mt:2,children:[(0,R.jsx)(l.A,{variant:"h6",children:se("cart.title")}),(0,R.jsx)(S.A,{dense:!0,children:H.orderItems.map(e=>(0,R.jsxs)(b.Ay,{divider:!0,children:[(0,R.jsx)(N.A,{primary:e.name+" x "+e.quantity||"Product ID: ".concat(e.productId)}),(0,R.jsxs)(l.A,{variant:"body2",children:["$",(e.price*e.quantity).toFixed(2)]})]},e.productId))})]}),H.shippingAddress&&(0,R.jsxs)(o.A,{mt:2,children:[(0,R.jsx)(l.A,{variant:"h6",children:se("checkout.shippingInfo")}),(0,R.jsx)(l.A,{children:H.shippingAddress})]})]}),(0,R.jsxs)(k.A,{children:[(0,R.jsx)(w.A,{onClick:le,children:se("action.cancel")}),(0,R.jsx)(w.A,{onClick:async()=>{if(H&&W!==H.status){J(!0);try{const e=await(0,M.OL)(H.id,W);r(r=>r.map(r=>r.id===e.id?e:r)),Y({open:!0,message:se("admin.orderManagementPage.updateSuccess"),severity:"success"}),le()}catch(e){console.error("Failed to update status:",e),Y({open:!0,message:se("admin.orderManagementPage.updateError"),severity:"error"})}finally{J(!1)}}},color:"primary",variant:"contained",disabled:$||W===(null===H||void 0===H?void 0:H.status),children:$?(0,R.jsx)(g.A,{size:24}):se("action.saveChanges")})]})]}),X.open&&(0,R.jsx)(A.A,{onClose:(e,r)=>{"clickaway"!==r&&Y((0,s.A)((0,s.A)({},X),{},{open:!1}))},severity:X.severity,sx:{width:"100%"},children:X.message})]})}}}]);
//# sourceMappingURL=241.323f41c5.chunk.js.map